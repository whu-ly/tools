#include "CILSEstimator.h"
#include "BaseMath.h"


//// inner function list
//bool    CheckInput(CILSEstimator* pStruct);
//bool    sort_mat(double vec[], double indices[], int n);
//bool    sort_rows(CILSEstimator* pStruct, Mat sqnorm, Mat afixed);
//double  normcdf(CILSEstimator* pStruct, double x);
//bool    ldldecom(CILSEstimator* pStruct, const Mat Qahat, Mat, Mat D);
//bool    decorrel(CILSEstimator* pStruct, const Mat Qahat, const Mat ahat, Mat Qzhat, Mat Z, Mat L, Mat D, Mat zhat, Mat iZt);
//bool    ssearch(CILSEstimator* pStruct, const Mat ahat, const Mat L, const Mat D, int ncands, Mat afixed, Mat sqnorm);
//double  ratioinv(CILSEstimator* pStruct, double Pf_FIX, double PfILS, int n);


/* 固定失败率Pf=0.001,ratio test的插值表格------------------------------------*/
static const float ls_table1[31][64]={{
0.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f
},{
0.0010f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f
},{
0.0012f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9600f,
0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f,
0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9700f, 0.9700f, 0.9700f, 0.9800f, 0.9800f,
0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f, 0.9800f,
0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f,
0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f, 0.9900f,
0.9900f, 0.9900f, 0.9900f, 0.9900f
},{
0.0015f, 0.8700f, 0.8700f, 0.8800f, 0.8800f, 0.8900f, 0.8900f, 0.8900f, 0.8900f, 0.9100f,
0.9200f, 0.9200f, 0.9200f, 0.9200f, 0.9300f, 0.9300f, 0.9300f, 0.9300f, 0.9300f, 0.9300f,
0.9300f, 0.9300f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9500f, 0.9500f,
0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9600f, 0.9600f, 0.9600f, 0.9600f,
0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f, 0.9600f,
0.9600f, 0.9700f, 0.9700f, 0.9700f, 0.9700f, 0.9700f, 0.9700f, 0.9700f, 0.9700f, 0.9700f,
0.9700f, 0.9700f, 0.9700f, 0.9700f
},{
0.0020f, 0.7800f, 0.7800f, 0.8000f, 0.8000f, 0.8100f, 0.8200f, 0.8300f, 0.8400f, 0.8400f,
0.8600f, 0.8600f, 0.8600f, 0.8700f, 0.8800f, 0.8800f, 0.8800f, 0.8900f, 0.8900f, 0.9000f,
0.9000f, 0.9000f, 0.9000f, 0.9000f, 0.9000f, 0.9100f, 0.9100f, 0.9100f, 0.9200f, 0.9200f,
0.9200f, 0.9200f, 0.9300f, 0.9300f, 0.9300f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f,
0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f, 0.9400f,
0.9400f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f, 0.9500f,
0.9500f, 0.9500f, 0.9500f, 0.9600f
},{
0.0050f, 0.5400f, 0.5400f, 0.5700f, 0.5700f, 0.5900f, 0.6400f, 0.6400f, 0.6800f, 0.6800f,
0.6900f, 0.7100f, 0.7200f, 0.7300f, 0.7400f, 0.7500f, 0.7500f, 0.7700f, 0.7800f, 0.8000f,
0.8000f, 0.8000f, 0.8000f, 0.8000f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8500f, 0.8600f, 0.8600f, 0.8600f, 0.8600f, 0.8700f, 0.8800f,
0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8900f, 0.8900f,
0.8900f, 0.9100f, 0.9100f, 0.9100f, 0.9100f, 0.9100f, 0.9100f, 0.9100f, 0.9100f, 0.9100f,
0.9100f, 0.9100f, 0.9100f, 0.9100f
},{
0.0100f, 0.3600f, 0.3800f, 0.4100f, 0.4300f, 0.4500f, 0.5100f, 0.5200f, 0.5700f, 0.5700f,
0.5900f, 0.6100f, 0.6200f, 0.6400f, 0.6500f, 0.6700f, 0.6700f, 0.6800f, 0.6900f, 0.7200f,
0.7200f, 0.7200f, 0.7200f, 0.7200f, 0.7400f, 0.7600f, 0.7600f, 0.7700f, 0.7900f, 0.7900f,
0.7900f, 0.7900f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f,
0.8400f, 0.8400f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f,
0.8500f, 0.8700f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f, 0.8800f,
0.8800f, 0.8800f, 0.8800f, 0.8800f
},{
0.0150f, 0.2700f, 0.2900f, 0.3200f, 0.3600f, 0.3800f, 0.4300f, 0.4600f, 0.5100f, 0.5200f,
0.5300f, 0.5500f, 0.5600f, 0.5800f, 0.6000f, 0.6200f, 0.6200f, 0.6400f, 0.6500f, 0.6700f,
0.6700f, 0.6900f, 0.6900f, 0.6900f, 0.7100f, 0.7400f, 0.7400f, 0.7400f, 0.7600f, 0.7600f,
0.7600f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f, 0.8000f, 0.8100f, 0.8100f,
0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8500f, 0.8500f, 0.8600f, 0.8600f, 0.8600f, 0.8600f, 0.8600f, 0.8600f, 0.8600f,
0.8700f, 0.8700f, 0.8700f, 0.8800f
},{
0.0200f, 0.2100f, 0.2400f, 0.2700f, 0.3000f, 0.3300f, 0.3800f, 0.4200f, 0.4600f, 0.4800f,
0.4900f, 0.5200f, 0.5200f, 0.5500f, 0.5700f, 0.5900f, 0.5900f, 0.6200f, 0.6200f, 0.6500f,
0.6500f, 0.6700f, 0.6700f, 0.6700f, 0.7000f, 0.7200f, 0.7200f, 0.7200f, 0.7400f, 0.7500f,
0.7500f, 0.7500f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8300f, 0.8300f,
0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f, 0.8500f,
0.8600f, 0.8600f, 0.8600f, 0.8700f
},{
0.0250f, 0.1900f, 0.2200f, 0.2400f, 0.2700f, 0.2900f, 0.3500f, 0.3900f, 0.4200f, 0.4500f,
0.4600f, 0.4900f, 0.4900f, 0.5300f, 0.5400f, 0.5600f, 0.5600f, 0.6000f, 0.6000f, 0.6300f,
0.6400f, 0.6500f, 0.6600f, 0.6600f, 0.6800f, 0.7100f, 0.7100f, 0.7100f, 0.7200f, 0.7200f,
0.7300f, 0.7400f, 0.7500f, 0.7500f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f,
0.7900f, 0.8000f, 0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f,
0.8300f, 0.8300f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8500f, 0.8500f, 0.8500f, 0.8500f,
0.8600f, 0.8600f, 0.8600f, 0.8700f
},{
0.0300f, 0.1700f, 0.2000f, 0.2200f, 0.2400f, 0.2600f, 0.3200f, 0.3500f, 0.4000f, 0.4200f,
0.4400f, 0.4700f, 0.4700f, 0.5100f, 0.5300f, 0.5400f, 0.5500f, 0.5800f, 0.5900f, 0.6200f,
0.6200f, 0.6400f, 0.6500f, 0.6500f, 0.6700f, 0.7000f, 0.7000f, 0.7000f, 0.7100f, 0.7100f,
0.7200f, 0.7300f, 0.7400f, 0.7500f, 0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f,
0.7800f, 0.7900f, 0.7900f, 0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f,
0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8500f, 0.8500f, 0.8500f,
0.8500f, 0.8600f, 0.8600f, 0.8600f
},{
0.0350f, 0.1600f, 0.1800f, 0.2000f, 0.2200f, 0.2400f, 0.3000f, 0.3300f, 0.3800f, 0.4000f,
0.4200f, 0.4500f, 0.4500f, 0.4900f, 0.5100f, 0.5300f, 0.5400f, 0.5700f, 0.5800f, 0.6100f,
0.6100f, 0.6300f, 0.6400f, 0.6500f, 0.6600f, 0.6900f, 0.6900f, 0.6900f, 0.7100f, 0.7100f,
0.7200f, 0.7200f, 0.7400f, 0.7400f, 0.7500f, 0.7500f, 0.7600f, 0.7600f, 0.7700f, 0.7700f,
0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.7900f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8100f,
0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8500f, 0.8500f,
0.8500f, 0.8500f, 0.8600f, 0.8600f
},{
0.0400f, 0.1500f, 0.1700f, 0.1800f, 0.2100f, 0.2200f, 0.2700f, 0.3100f, 0.3600f, 0.3900f,
0.4000f, 0.4400f, 0.4400f, 0.4800f, 0.5000f, 0.5200f, 0.5300f, 0.5600f, 0.5600f, 0.6000f,
0.6100f, 0.6200f, 0.6400f, 0.6500f, 0.6600f, 0.6800f, 0.6900f, 0.6900f, 0.7000f, 0.7100f,
0.7100f, 0.7100f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7500f, 0.7600f, 0.7600f, 0.7700f,
0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.7900f, 0.8000f, 0.8100f, 0.8100f, 0.8100f,
0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8500f, 0.8500f,
0.8500f, 0.8500f, 0.8500f, 0.8600f
},{
0.0450f, 0.1400f, 0.1600f, 0.1700f, 0.1900f, 0.2100f, 0.2600f, 0.2900f, 0.3400f, 0.3800f,
0.3900f, 0.4300f, 0.4400f, 0.4800f, 0.4900f, 0.5100f, 0.5200f, 0.5600f, 0.5600f, 0.5900f,
0.6000f, 0.6100f, 0.6300f, 0.6500f, 0.6500f, 0.6700f, 0.6800f, 0.6800f, 0.7000f, 0.7100f,
0.7100f, 0.7100f, 0.7300f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7500f, 0.7600f, 0.7700f,
0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.7900f, 0.8000f, 0.8000f, 0.8100f,
0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8500f, 0.8500f, 0.8600f
},{
0.0500f, 0.1300f, 0.1500f, 0.1600f, 0.1800f, 0.1900f, 0.2400f, 0.2800f, 0.3200f, 0.3700f,
0.3900f, 0.4200f, 0.4300f, 0.4700f, 0.4800f, 0.5100f, 0.5200f, 0.5500f, 0.5500f, 0.5900f,
0.6000f, 0.6100f, 0.6300f, 0.6400f, 0.6400f, 0.6700f, 0.6800f, 0.6800f, 0.6900f, 0.7100f,
0.7100f, 0.7100f, 0.7200f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7500f, 0.7600f, 0.7600f,
0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.7900f, 0.8000f, 0.8100f,
0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8600f
},{
0.0550f, 0.1200f, 0.1400f, 0.1500f, 0.1700f, 0.1800f, 0.2300f, 0.2700f, 0.3100f, 0.3600f,
0.3800f, 0.4100f, 0.4200f, 0.4600f, 0.4800f, 0.5000f, 0.5100f, 0.5400f, 0.5500f, 0.5800f,
0.5900f, 0.6000f, 0.6200f, 0.6400f, 0.6400f, 0.6600f, 0.6700f, 0.6800f, 0.6900f, 0.7000f,
0.7000f, 0.7000f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7500f, 0.7500f, 0.7500f, 0.7600f,
0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f, 0.8000f,
0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8600f
},{
0.0600f, 0.1200f, 0.1300f, 0.1500f, 0.1600f, 0.1700f, 0.2100f, 0.2600f, 0.3000f, 0.3600f,
0.3700f, 0.4000f, 0.4200f, 0.4600f, 0.4700f, 0.5000f, 0.5100f, 0.5400f, 0.5400f, 0.5800f,
0.5900f, 0.6000f, 0.6200f, 0.6300f, 0.6300f, 0.6600f, 0.6700f, 0.6700f, 0.6900f, 0.7000f,
0.7000f, 0.7000f, 0.7100f, 0.7200f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7500f, 0.7600f,
0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f, 0.8000f,
0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8600f
},{
0.0650f, 0.1100f, 0.1200f, 0.1400f, 0.1500f, 0.1600f, 0.2000f, 0.2600f, 0.3000f, 0.3500f,
0.3600f, 0.4000f, 0.4100f, 0.4500f, 0.4600f, 0.5000f, 0.5100f, 0.5300f, 0.5400f, 0.5800f,
0.5900f, 0.5900f, 0.6100f, 0.6300f, 0.6300f, 0.6600f, 0.6700f, 0.6700f, 0.6800f, 0.7000f,
0.7000f, 0.7000f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7500f, 0.7500f, 0.7600f,
0.7600f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f, 0.8000f,
0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8500f
},{
0.0700f, 0.1100f, 0.1200f, 0.1300f, 0.1400f, 0.1500f, 0.2000f, 0.2500f, 0.3000f, 0.3500f,
0.3600f, 0.3900f, 0.4100f, 0.4500f, 0.4600f, 0.4900f, 0.5000f, 0.5300f, 0.5400f, 0.5800f,
0.5800f, 0.5900f, 0.6100f, 0.6300f, 0.6300f, 0.6600f, 0.6600f, 0.6700f, 0.6800f, 0.6900f,
0.6900f, 0.7000f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7600f,
0.7600f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.8000f, 0.8000f,
0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8500f, 0.8500f
},{
0.0750f, 0.1000f, 0.1100f, 0.1200f, 0.1300f, 0.1500f, 0.1900f, 0.2400f, 0.2900f, 0.3400f,
0.3600f, 0.3900f, 0.4100f, 0.4400f, 0.4500f, 0.4900f, 0.5000f, 0.5200f, 0.5400f, 0.5700f,
0.5800f, 0.5900f, 0.6100f, 0.6300f, 0.6300f, 0.6500f, 0.6600f, 0.6700f, 0.6800f, 0.6900f,
0.6900f, 0.6900f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7600f,
0.7600f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.8000f, 0.8000f,
0.8000f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8400f, 0.8500f
},{
0.0800f, 0.1000f, 0.1000f, 0.1200f, 0.1300f, 0.1400f, 0.1900f, 0.2300f, 0.2900f, 0.3400f,
0.3500f, 0.3800f, 0.4000f, 0.4400f, 0.4500f, 0.4900f, 0.5000f, 0.5200f, 0.5300f, 0.5700f,
0.5800f, 0.5900f, 0.6100f, 0.6200f, 0.6200f, 0.6500f, 0.6600f, 0.6700f, 0.6800f, 0.6900f,
0.6900f, 0.6900f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7600f,
0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8000f, 0.8000f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8400f, 0.8400f,
0.8400f, 0.8400f, 0.8400f, 0.8500f
},{
0.0850f, 0.1000f, 0.1000f, 0.1100f, 0.1200f, 0.1400f, 0.1800f, 0.2300f, 0.2800f, 0.3300f,
0.3500f, 0.3800f, 0.4000f, 0.4400f, 0.4500f, 0.4900f, 0.5000f, 0.5100f, 0.5300f, 0.5700f,
0.5800f, 0.5900f, 0.6100f, 0.6200f, 0.6200f, 0.6500f, 0.6600f, 0.6700f, 0.6800f, 0.6800f,
0.6900f, 0.6900f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7400f, 0.7500f, 0.7600f,
0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8000f, 0.8000f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8300f, 0.8300f,
0.8300f, 0.8400f, 0.8400f, 0.8500f
},{
0.0900f, 0.0900f, 0.0900f, 0.1100f, 0.1200f, 0.1300f, 0.1800f, 0.2200f, 0.2800f, 0.3300f,
0.3500f, 0.3800f, 0.4000f, 0.4300f, 0.4500f, 0.4900f, 0.5000f, 0.5100f, 0.5300f, 0.5600f,
0.5800f, 0.5900f, 0.6100f, 0.6200f, 0.6200f, 0.6500f, 0.6600f, 0.6600f, 0.6700f, 0.6700f,
0.6900f, 0.6900f, 0.7100f, 0.7100f, 0.7300f, 0.7300f, 0.7300f, 0.7400f, 0.7500f, 0.7600f,
0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f, 0.8300f,
0.8300f, 0.8400f, 0.8400f, 0.8500f
},{
0.0950f, 0.0900f, 0.0900f, 0.1000f, 0.1100f, 0.1300f, 0.1800f, 0.2200f, 0.2800f, 0.3300f,
0.3400f, 0.3800f, 0.4000f, 0.4300f, 0.4500f, 0.4800f, 0.4900f, 0.5100f, 0.5300f, 0.5600f,
0.5700f, 0.5900f, 0.6100f, 0.6200f, 0.6200f, 0.6500f, 0.6500f, 0.6600f, 0.6700f, 0.6700f,
0.6800f, 0.6900f, 0.7100f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7500f, 0.7500f,
0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f,
0.8300f, 0.8400f, 0.8400f, 0.8500f
},{
0.1000f, 0.0900f, 0.0900f, 0.1000f, 0.1100f, 0.1200f, 0.1700f, 0.2200f, 0.2700f, 0.3200f,
0.3400f, 0.3700f, 0.4000f, 0.4300f, 0.4400f, 0.4800f, 0.4900f, 0.5100f, 0.5300f, 0.5600f,
0.5700f, 0.5800f, 0.6100f, 0.6200f, 0.6200f, 0.6400f, 0.6500f, 0.6600f, 0.6700f, 0.6700f,
0.6800f, 0.6900f, 0.7100f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7500f, 0.7500f,
0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f, 0.8000f,
0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f,
0.8300f, 0.8300f, 0.8400f, 0.8500f
},{
0.1200f, 0.0800f, 0.0800f, 0.0900f, 0.0900f, 0.1100f, 0.1600f, 0.2100f, 0.2600f, 0.3100f,
0.3300f, 0.3700f, 0.3900f, 0.4200f, 0.4400f, 0.4800f, 0.4900f, 0.5100f, 0.5300f, 0.5500f,
0.5700f, 0.5800f, 0.6000f, 0.6100f, 0.6100f, 0.6400f, 0.6400f, 0.6600f, 0.6700f, 0.6700f,
0.6800f, 0.6800f, 0.7000f, 0.7100f, 0.7200f, 0.7200f, 0.7300f, 0.7400f, 0.7400f, 0.7500f,
0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7800f, 0.7900f, 0.7900f,
0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f, 0.8300f, 0.8300f,
0.8300f, 0.8300f, 0.8400f, 0.8400f
},{
0.1500f, 0.0700f, 0.0700f, 0.0800f, 0.0800f, 0.1000f, 0.1600f, 0.2000f, 0.2500f, 0.2900f,
0.3200f, 0.3500f, 0.3900f, 0.4100f, 0.4400f, 0.4700f, 0.4900f, 0.5000f, 0.5200f, 0.5500f,
0.5600f, 0.5700f, 0.6000f, 0.6100f, 0.6100f, 0.6400f, 0.6400f, 0.6600f, 0.6600f, 0.6600f,
0.6800f, 0.6800f, 0.7000f, 0.7100f, 0.7100f, 0.7200f, 0.7300f, 0.7300f, 0.7400f, 0.7500f,
0.7600f, 0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f, 0.7900f,
0.7900f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8300f, 0.8300f,
0.8300f, 0.8300f, 0.8400f, 0.8400f
},{
0.2000f, 0.0500f, 0.0500f, 0.0600f, 0.0600f, 0.1000f, 0.1500f, 0.1900f, 0.2400f, 0.2700f,
0.3100f, 0.3400f, 0.3800f, 0.4100f, 0.4300f, 0.4600f, 0.4800f, 0.5000f, 0.5100f, 0.5400f,
0.5500f, 0.5700f, 0.5900f, 0.6000f, 0.6100f, 0.6400f, 0.6400f, 0.6500f, 0.6600f, 0.6600f,
0.6800f, 0.6800f, 0.7000f, 0.7100f, 0.7100f, 0.7100f, 0.7300f, 0.7300f, 0.7400f, 0.7500f,
0.7600f, 0.7600f, 0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7800f, 0.7800f, 0.7900f,
0.7900f, 0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f,
0.8300f, 0.8300f, 0.8300f, 0.8400f
},{
0.2500f, 0.0400f, 0.0400f, 0.0500f, 0.0600f, 0.0900f, 0.1400f, 0.1800f, 0.2300f, 0.2500f,
0.3000f, 0.3400f, 0.3700f, 0.4100f, 0.4300f, 0.4600f, 0.4700f, 0.5000f, 0.5100f, 0.5400f,
0.5500f, 0.5700f, 0.5900f, 0.6000f, 0.6000f, 0.6300f, 0.6400f, 0.6500f, 0.6600f, 0.6600f,
0.6800f, 0.6800f, 0.7000f, 0.7000f, 0.7100f, 0.7100f, 0.7300f, 0.7300f, 0.7400f, 0.7500f,
0.7500f, 0.7600f, 0.7600f, 0.7600f, 0.7600f, 0.7700f, 0.7700f, 0.7700f, 0.7800f, 0.7800f,
0.7900f, 0.8000f, 0.8000f, 0.8100f, 0.8100f, 0.8100f, 0.8100f, 0.8200f, 0.8200f, 0.8200f,
0.8200f, 0.8300f, 0.8300f, 0.8400f
},{
0.2600f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f
},{
1.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f
}};

/* 固定失败率Pf=0.01,ratio test的插值表格-------------------------------------*/
static const float ls_table10[31][41]={{
0.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f
},{
0.0100f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f, 1.0000f,
1.0000f
},{
0.0110f, 0.9635f, 0.9662f, 0.9690f, 0.9714f, 0.9732f, 0.9781f, 0.9777f, 0.9786f, 0.9801f,
0.9816f, 0.9761f, 0.9706f, 0.9762f, 0.9817f, 0.9811f, 0.9842f, 0.9842f, 0.9842f, 0.9868f,
0.9894f, 0.9874f, 0.9876f, 0.9869f, 0.9862f, 0.9891f, 0.9919f, 0.9880f, 0.9922f, 0.9902f,
0.9882f, 0.9920f, 0.9958f, 0.9958f, 0.9958f, 0.9958f, 0.9958f, 0.9958f, 0.9958f, 0.9958f,
0.9958f
},{
0.0160f, 0.7998f, 0.8149f, 0.8300f, 0.8406f, 0.8515f, 0.8781f, 0.8800f, 0.8837f, 0.8905f,
0.8973f, 0.8969f, 0.8965f, 0.9054f, 0.9142f, 0.9204f, 0.9141f, 0.9221f, 0.9301f, 0.9342f,
0.9382f, 0.9378f, 0.9415f, 0.9422f, 0.9429f, 0.9476f, 0.9523f, 0.9463f, 0.9591f, 0.9553f,
0.9516f, 0.9635f, 0.9755f, 0.9755f, 0.9755f, 0.9755f, 0.9755f, 0.9755f, 0.9755f, 0.9755f,
0.9755f
},{
0.0210f, 0.6824f, 0.7028f, 0.7232f, 0.7435f, 0.7621f, 0.7951f, 0.7999f, 0.8191f, 0.8289f,
0.8387f, 0.8424f, 0.8461f, 0.8566f, 0.8670f, 0.8779f, 0.8682f, 0.8793f, 0.8904f, 0.8949f,
0.8995f, 0.9033f, 0.9089f, 0.9109f, 0.9129f, 0.9161f, 0.9194f, 0.9196f, 0.9296f, 0.9277f,
0.9257f, 0.9399f, 0.9541f, 0.9541f, 0.9541f, 0.9541f, 0.9541f, 0.9541f, 0.9541f, 0.9541f,
0.9541f
},{
0.0260f, 0.5879f, 0.6139f, 0.6400f, 0.6721f, 0.7004f, 0.7297f, 0.7405f, 0.7750f, 0.7873f,
0.7996f, 0.8024f, 0.8053f, 0.8202f, 0.8352f, 0.8446f, 0.8439f, 0.8546f, 0.8653f, 0.8704f,
0.8754f, 0.8811f, 0.8841f, 0.8879f, 0.8917f, 0.8953f, 0.8988f, 0.8982f, 0.9055f, 0.9062f,
0.9069f, 0.9197f, 0.9325f, 0.9325f, 0.9325f, 0.9325f, 0.9325f, 0.9325f, 0.9325f, 0.9325f,
0.9325f
},{
0.0310f, 0.5198f, 0.5514f, 0.5830f, 0.6154f, 0.6500f, 0.6794f, 0.7006f, 0.7422f, 0.7556f,
0.7690f, 0.7723f, 0.7756f, 0.7928f, 0.8099f, 0.8188f, 0.8263f, 0.8351f, 0.8439f, 0.8494f,
0.8549f, 0.8622f, 0.8667f, 0.8711f, 0.8756f, 0.8790f, 0.8824f, 0.8821f, 0.8890f, 0.8910f,
0.8929f, 0.9026f, 0.9123f, 0.9123f, 0.9123f, 0.9123f, 0.9123f, 0.9123f, 0.9123f, 0.9123f,
0.9123f
},{
0.0360f, 0.4785f, 0.5086f, 0.5388f, 0.5707f, 0.5993f, 0.6428f, 0.6693f, 0.7145f, 0.7290f,
0.7435f, 0.7490f, 0.7546f, 0.7721f, 0.7896f, 0.7973f, 0.8094f, 0.8176f, 0.8258f, 0.8316f,
0.8374f, 0.8459f, 0.8527f, 0.8577f, 0.8627f, 0.8653f, 0.8680f, 0.8696f, 0.8767f, 0.8796f,
0.8824f, 0.8886f, 0.8947f, 0.8947f, 0.8947f, 0.8947f, 0.8947f, 0.8947f, 0.8947f, 0.8947f,
0.8947f
},{
0.0410f, 0.4392f, 0.4715f, 0.5039f, 0.5337f, 0.5535f, 0.6109f, 0.6434f, 0.6894f, 0.7046f,
0.7198f, 0.7277f, 0.7356f, 0.7542f, 0.7729f, 0.7787f, 0.7941f, 0.8023f, 0.8104f, 0.8165f,
0.8226f, 0.8319f, 0.8408f, 0.8462f, 0.8516f, 0.8535f, 0.8555f, 0.8588f, 0.8670f, 0.8706f,
0.8743f, 0.8779f, 0.8814f, 0.8814f, 0.8814f, 0.8814f, 0.8814f, 0.8814f, 0.8814f, 0.8814f,
0.8814f
},{
0.0460f, 0.4110f, 0.4431f, 0.4751f, 0.5024f, 0.5223f, 0.5831f, 0.6201f, 0.6669f, 0.6821f,
0.6973f, 0.7075f, 0.7178f, 0.7378f, 0.7578f, 0.7634f, 0.7802f, 0.7888f, 0.7975f, 0.8039f,
0.8103f, 0.8198f, 0.8309f, 0.8365f, 0.8420f, 0.8434f, 0.8448f, 0.8495f, 0.8597f, 0.8632f,
0.8667f, 0.8700f, 0.8732f, 0.8732f, 0.8732f, 0.8732f, 0.8732f, 0.8732f, 0.8732f, 0.8732f,
0.8732f
},{
0.0510f, 0.3880f, 0.4187f, 0.4494f, 0.4754f, 0.4960f, 0.5589f, 0.5991f, 0.6470f, 0.6617f,
0.6765f, 0.6895f, 0.7024f, 0.7233f, 0.7442f, 0.7507f, 0.7672f, 0.7768f, 0.7865f, 0.7933f,
0.8001f, 0.8094f, 0.8229f, 0.8283f, 0.8338f, 0.8348f, 0.8359f, 0.8412f, 0.8537f, 0.8567f,
0.8597f, 0.8632f, 0.8666f, 0.8666f, 0.8666f, 0.8666f, 0.8666f, 0.8666f, 0.8666f, 0.8666f,
0.8666f
},{
0.0560f, 0.3673f, 0.3969f, 0.4265f, 0.4515f, 0.4734f, 0.5380f, 0.5803f, 0.6297f, 0.6440f,
0.6582f, 0.6736f, 0.6890f, 0.7104f, 0.7318f, 0.7394f, 0.7561f, 0.7665f, 0.7769f, 0.7842f,
0.7916f, 0.8001f, 0.8166f, 0.8216f, 0.8266f, 0.8276f, 0.8286f, 0.8337f, 0.8480f, 0.8506f,
0.8532f, 0.8570f, 0.8608f, 0.8608f, 0.8608f, 0.8608f, 0.8608f, 0.8608f, 0.8608f, 0.8608f,
0.8608f
},{
0.0610f, 0.3492f, 0.3777f, 0.4062f, 0.4303f, 0.4535f, 0.5199f, 0.5639f, 0.6151f, 0.6290f,
0.6429f, 0.6598f, 0.6768f, 0.6989f, 0.7210f, 0.7294f, 0.7469f, 0.7578f, 0.7686f, 0.7763f,
0.7840f, 0.7918f, 0.8109f, 0.8154f, 0.8199f, 0.8214f, 0.8229f, 0.8267f, 0.8426f, 0.8449f,
0.8472f, 0.8514f, 0.8556f, 0.8556f, 0.8556f, 0.8556f, 0.8556f, 0.8556f, 0.8556f, 0.8556f,
0.8556f
},{
0.0660f, 0.3337f, 0.3611f, 0.3885f, 0.4118f, 0.4352f, 0.5042f, 0.5498f, 0.6030f, 0.6170f,
0.6311f, 0.6483f, 0.6655f, 0.6885f, 0.7115f, 0.7207f, 0.7380f, 0.7496f, 0.7612f, 0.7693f,
0.7774f, 0.7845f, 0.8055f, 0.8095f, 0.8136f, 0.8159f, 0.8181f, 0.8208f, 0.8375f, 0.8396f,
0.8417f, 0.8464f, 0.8510f, 0.8510f, 0.8510f, 0.8510f, 0.8510f, 0.8510f, 0.8510f, 0.8510f,
0.8510f
},{
0.0710f, 0.3209f, 0.3470f, 0.3731f, 0.3962f, 0.4182f, 0.4902f, 0.5370f, 0.5923f, 0.6072f,
0.6221f, 0.6386f, 0.6550f, 0.6792f, 0.7035f, 0.7131f, 0.7294f, 0.7419f, 0.7545f, 0.7630f,
0.7715f, 0.7782f, 0.8003f, 0.8041f, 0.8078f, 0.8107f, 0.8137f, 0.8160f, 0.8327f, 0.8347f,
0.8367f, 0.8419f, 0.8470f, 0.8470f, 0.8470f, 0.8470f, 0.8470f, 0.8470f, 0.8470f, 0.8470f,
0.8470f
},{
0.0760f, 0.3100f, 0.3350f, 0.3601f, 0.3834f, 0.4028f, 0.4777f, 0.5248f, 0.5828f, 0.5983f,
0.6138f, 0.6296f, 0.6454f, 0.6709f, 0.6965f, 0.7059f, 0.7213f, 0.7348f, 0.7483f, 0.7574f,
0.7664f, 0.7727f, 0.7955f, 0.7989f, 0.8024f, 0.8060f, 0.8097f, 0.8120f, 0.8283f, 0.8303f,
0.8323f, 0.8379f, 0.8436f, 0.8436f, 0.8436f, 0.8436f, 0.8436f, 0.8436f, 0.8436f, 0.8436f,
0.8436f
},{
0.0810f, 0.3003f, 0.3245f, 0.3488f, 0.3723f, 0.3894f, 0.4660f, 0.5133f, 0.5743f, 0.5901f,
0.6060f, 0.6214f, 0.6368f, 0.6633f, 0.6899f, 0.6992f, 0.7138f, 0.7281f, 0.7424f, 0.7522f,
0.7620f, 0.7681f, 0.7909f, 0.7941f, 0.7974f, 0.8017f, 0.8060f, 0.8084f, 0.8243f, 0.8263f,
0.8284f, 0.8345f, 0.8406f, 0.8406f, 0.8406f, 0.8406f, 0.8406f, 0.8406f, 0.8406f, 0.8406f,
0.8406f
},{
0.0860f, 0.2912f, 0.3149f, 0.3386f, 0.3621f, 0.3783f, 0.4547f, 0.5026f, 0.5664f, 0.5826f,
0.5987f, 0.6139f, 0.6291f, 0.6564f, 0.6837f, 0.6929f, 0.7069f, 0.7218f, 0.7367f, 0.7474f,
0.7582f, 0.7637f, 0.7865f, 0.7898f, 0.7930f, 0.7978f, 0.8027f, 0.8052f, 0.8206f, 0.8228f,
0.8250f, 0.8315f, 0.8381f, 0.8381f, 0.8381f, 0.8381f, 0.8381f, 0.8381f, 0.8381f, 0.8381f,
0.8381f
},{
0.0910f, 0.2825f, 0.3055f, 0.3285f, 0.3528f, 0.3685f, 0.4439f, 0.4928f, 0.5591f, 0.5755f,
0.5920f, 0.6070f, 0.6220f, 0.6499f, 0.6778f, 0.6871f, 0.7009f, 0.7160f, 0.7312f, 0.7430f,
0.7548f, 0.7596f, 0.7824f, 0.7858f, 0.7891f, 0.7944f, 0.7997f, 0.8023f, 0.8172f, 0.8196f,
0.8220f, 0.8289f, 0.8359f, 0.8359f, 0.8359f, 0.8359f, 0.8359f, 0.8359f, 0.8359f, 0.8359f,
0.8359f
},{
0.0960f, 0.2736f, 0.2958f, 0.3179f, 0.3441f, 0.3595f, 0.4337f, 0.4839f, 0.5519f, 0.5688f,
0.5856f, 0.6008f, 0.6160f, 0.6442f, 0.6723f, 0.6818f, 0.6957f, 0.7109f, 0.7262f, 0.7388f,
0.7515f, 0.7558f, 0.7786f, 0.7821f, 0.7857f, 0.7913f, 0.7969f, 0.7998f, 0.8142f, 0.8167f,
0.8192f, 0.8265f, 0.8339f, 0.8339f, 0.8339f, 0.8339f, 0.8339f, 0.8339f, 0.8339f, 0.8339f,
0.8339f
},{
0.1200f, 0.2294f, 0.2497f, 0.2700f, 0.2989f, 0.3241f, 0.3954f, 0.4541f, 0.5183f, 0.5395f,
0.5607f, 0.5801f, 0.5995f, 0.6252f, 0.6509f, 0.6622f, 0.6812f, 0.6958f, 0.7104f, 0.7239f,
0.7373f, 0.7418f, 0.7635f, 0.7684f, 0.7733f, 0.7802f, 0.7872f, 0.7907f, 0.8051f, 0.8069f,
0.8087f, 0.8171f, 0.8254f, 0.8254f, 0.8254f, 0.8254f, 0.8254f, 0.8254f, 0.8254f, 0.8254f,
0.8254f
},{
0.1500f, 0.1736f, 0.2027f, 0.2318f, 0.2595f, 0.2893f, 0.3658f, 0.4295f, 0.4860f, 0.5119f,
0.5378f, 0.5621f, 0.5863f, 0.6100f, 0.6338f, 0.6497f, 0.6696f, 0.6850f, 0.7004f, 0.7120f,
0.7236f, 0.7327f, 0.7517f, 0.7576f, 0.7634f, 0.7718f, 0.7802f, 0.7850f, 0.7985f, 0.8008f,
0.8032f, 0.8103f, 0.8175f, 0.8175f, 0.8175f, 0.8175f, 0.8175f, 0.8175f, 0.8175f, 0.8175f,
0.8175f
},{
0.2000f, 0.0986f, 0.1392f, 0.1797f, 0.2181f, 0.2581f, 0.3283f, 0.4013f, 0.4499f, 0.4799f,
0.5099f, 0.5390f, 0.5680f, 0.5921f, 0.6162f, 0.6369f, 0.6574f, 0.6725f, 0.6876f, 0.6995f,
0.7114f, 0.7234f, 0.7417f, 0.7475f, 0.7534f, 0.7631f, 0.7728f, 0.7797f, 0.7904f, 0.7943f,
0.7983f, 0.8034f, 0.8085f, 0.8085f, 0.8085f, 0.8085f, 0.8085f, 0.8085f, 0.8085f, 0.8085f,
0.8085f
},{
0.2500f, 0.0394f, 0.0909f, 0.1424f, 0.1873f, 0.2355f, 0.2974f, 0.3791f, 0.4209f, 0.4555f,
0.4900f, 0.5217f, 0.5535f, 0.5799f, 0.6062f, 0.6283f, 0.6476f, 0.6621f, 0.6766f, 0.6909f,
0.7051f, 0.7173f, 0.7305f, 0.7389f, 0.7474f, 0.7578f, 0.7681f, 0.7749f, 0.7851f, 0.7894f,
0.7937f, 0.7975f, 0.8013f, 0.8013f, 0.8013f, 0.8013f, 0.8013f, 0.8013f, 0.8013f, 0.8013f,
0.8013f
},{
0.3000f, 0.0210f, 0.0711f, 0.1212f, 0.1689f, 0.2136f, 0.2731f, 0.3608f, 0.3978f, 0.4363f,
0.4748f, 0.5090f, 0.5432f, 0.5711f, 0.5989f, 0.6215f, 0.6396f, 0.6545f, 0.6693f, 0.6852f,
0.7011f, 0.7122f, 0.7202f, 0.7315f, 0.7428f, 0.7534f, 0.7641f, 0.7707f, 0.7816f, 0.7858f,
0.7899f, 0.7927f, 0.7954f, 0.7954f, 0.7954f, 0.7954f, 0.7954f, 0.7954f, 0.7954f, 0.7954f,
0.7954f
},{
0.3500f, 0.0113f, 0.0600f, 0.1086f, 0.1539f, 0.1971f, 0.2541f, 0.3459f, 0.3831f, 0.4243f,
0.4654f, 0.5010f, 0.5367f, 0.5648f, 0.5930f, 0.6164f, 0.6340f, 0.6490f, 0.6639f, 0.6814f,
0.6988f, 0.7084f, 0.7147f, 0.7270f, 0.7393f, 0.7502f, 0.7610f, 0.7668f, 0.7787f, 0.7830f,
0.7873f, 0.7899f, 0.7925f, 0.7925f, 0.7925f, 0.7925f, 0.7925f, 0.7925f, 0.7925f, 0.7925f,
0.7925f
},{
0.4000f, 0.0112f, 0.0555f, 0.0997f, 0.1425f, 0.1848f, 0.2390f, 0.3341f, 0.3721f, 0.4153f,
0.4586f, 0.4950f, 0.5315f, 0.5593f, 0.5872f, 0.6129f, 0.6314f, 0.6454f, 0.6593f, 0.6782f,
0.6971f, 0.7068f, 0.7139f, 0.7253f, 0.7366f, 0.7479f, 0.7593f, 0.7657f, 0.7765f, 0.7810f,
0.7855f, 0.7889f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f,
0.7924f
},{
0.4500f, 0.0111f, 0.0520f, 0.0928f, 0.1337f, 0.1751f, 0.2291f, 0.3245f, 0.3613f, 0.4086f,
0.4558f, 0.4914f, 0.5270f, 0.5544f, 0.5818f, 0.6101f, 0.6298f, 0.6430f, 0.6562f, 0.6760f,
0.6958f, 0.7057f, 0.7134f, 0.7240f, 0.7345f, 0.7464f, 0.7584f, 0.7651f, 0.7758f, 0.7799f,
0.7841f, 0.7882f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f,
0.7924f
},{
0.4990f, 0.0086f, 0.0484f, 0.0881f, 0.1279f, 0.1677f, 0.2232f, 0.3162f, 0.3570f, 0.4060f,
0.4550f, 0.4888f, 0.5227f, 0.5499f, 0.5771f, 0.6086f, 0.6285f, 0.6417f, 0.6550f, 0.6752f,
0.6954f, 0.7053f, 0.7132f, 0.7232f, 0.7331f, 0.7455f, 0.7579f, 0.7649f, 0.7758f, 0.7796f,
0.7834f, 0.7879f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f, 0.7924f,
0.7924f
},{
0.5000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f
},{
1.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f, 0.0000f,
0.0000f
}};

#define SGN(x)      ((x)<=0.0?((x)==0?0:-1.0):1.0)


static bool CheckInput(CILSEstimator* pStruct)
{
    if (!pStruct)return false;

    //Is the Q-matrix symmetric?
    //如果非对称,一般都有问题
    if (!MatrixIsSymmetric(pStruct->m_nfixed, pStruct->m_nfixed, pStruct->m_QFloat))
    {
        return false;
    }

    return true;
}


/* 将向量vec从小到大排序 -----------------------------------------------------
* input data, 如果vec中有相同值的,会存在问题,vec中的值必须不同
* ----------
* vec         : 待排序向量(nx1或1xn)
*
* output data
* -----------
* vec         : 排序好的向量,从小到大
* indices     : 排序完后的vec,在原来vec中的位置
* reurn data
* -----------
* bool        :
*-----------------------------------------------------------------------------*/
static bool sort_mat(double vec[], int indices[], int n)
{
    if (n <= 1)return false;

    // 初始化索引数组
    for (int i = 0; i < n; i++) {
        indices[i] = i;
    }

    // 冒泡排序
    for (int i = 0; i < n - 1; i++) {
        for (int j = 0; j < n - i - 1; j++) {
            if (vec[j] > vec[j + 1]) {
                // 交换元素
                double temp1 = vec[j];
                vec[j] = vec[j + 1];
                vec[j + 1] = temp1;

                // 同时交换索引数组中的对应索引
                int temp2 = indices[j];
                indices[j] = indices[j + 1];
                indices[j + 1] = temp2;
            }
        }
    }

    return true;
}


// Sort candidates based on their quadratic form of residuals
// ncands、maxncands：前者是实际搜索候选解数量，后者是最大搜索候选解数量，对应afixed中列数
static bool sort_rows(double sqnorm[], double afixed[], int nfixed, int ncands, int maxncands)
{
    if (ncands > NCANDS)return false;

    int i, ord, order[NCANDS] = { 0 };
    double afixedt[MAXOBSLIM * NCANDS] = { 0.0 };
    MatrixCopy(nfixed, maxncands, afixed, afixedt);

    sort_mat(sqnorm, order, ncands);
    for (int j = 0; j < ncands; j++)
    {
        ord = order[j];
        //if (ord == j) continue;
        for (i = 0; i < nfixed; i++) afixed[i * ncands + j] = afixedt[i * maxncands + ord];
    }

    return true;
}


// 负无穷到x的高斯误差积分
static double normcdf(double x)
{
    static const double gamma = 0.231641900,
        a1 = 0.319381530,
        a2 = -0.356563782,
        a3 = 1.781477973,
        a4 = -1.821255978,
        a5 = 1.330274429;

    double k = 1.0 / (1 + fabs(x) * gamma);
    double n = k * (a1 + k * (a2 + k * (a3 + k * (a4 + k * a5))));

    /* this guards against overflow */
    if (x > 6)  return 1;
    if (x < -6) return 0;

    n = 1 - (exp((-1) * x * x / 2) / sqrt(2 * PI)) * n;
    if (x < 0) return (1.0 - n);

    return n;
}


// Qahat is a square matrix with the dimension of "nfixed"
static bool ldldecom(const double Qahat[], double L[], double D[], int nfixed)
{
    int row = nfixed;
    double Qahat_[MAXOBSLIM * MAXOBSLIM];
    MatrixCopy(row, row, Qahat, Qahat_);
    double a = 0;

    for (int i = row - 1; i >= 0; i--)
    {
        if ((D[i] = Qahat_[i * row + i]) <= 0)
        {
            return false;
        }
        a = sqrt(Qahat_[i * row + i]);
        for (int k = 0; k <= i; k++) L[i * row + k] = Qahat_[i * row + k] / a;
        for (int j = 0; j <= i - 1; j++) for (int k = 0; k <= j; k++) Qahat_[j * row + k] = Qahat_[j * row + k] - L[i * row + k] * L[i * row + j];
        for (int k = 0; k <= i; k++) L[i * row + k] = L[i * row + k] / L[i * row + i];
    }

    for (int i = 0; i < row; i++)
    {
        if (D[i] < 1E-10)
        {
            return false;
        }
    }

    return true;
}


// Qahat is a square matrix with the dimension of "nfixed"
static bool decorrel(const double Qahat[], const double ahat[], double Qzhat[], double Z[], double L[], double D[], double zhat[], double iZt[], int nfixed)
{
    //--- Initialisations ---
    int row = nfixed;
    int r;
    int il = row - 1;
    int sw = 1;
    int i = 0, j = 0;
    int mu = 0;
    double delta = 0;
    double lambda = 0;
    double eta = 0;
    double as[2 * 2];
    double tmp[2 * MAXOBSLIM];
    double as_tmp[2 * MAXOBSLIM];
    MatrixUnit(row, row, iZt);

    // --- LtDL decomposition ---
    if (ldldecom(Qahat, L, D, row) == false)
    {
        return false;
    }

    while (sw)
    {
        i = row;
        sw = 0;

        while ((!sw) && (i > 1))
        {
            i = i - 1;

            if (i <= il)
            {
                for (int j = i; j < row; j++)
                {
                    mu = (int)(RoundNum(L[j * row + i - 1]));
                    if (mu)
                    {
                        for (int k = j; k < row; k++) L[k * row + i - 1] = L[k * row + i - 1] - mu * L[k * row + j];
                        for (int k = 0; k < row; k++) iZt[k * row + j] = iZt[k * row + j] + mu * iZt[k * row + i - 1];
                    }
                }
            }

            delta = D[i - 1] + (L[i * row + i - 1]) * (L[i * row + i - 1]) * D[i];

            if (delta < D[i])
            {
                lambda = D[i] * L[i * row + i - 1] / delta;
                eta = D[i - 1] / delta;
                D[i - 1] = eta * D[i];
                D[i] = delta;

                as[0] = -L[i * row + i - 1]; as[1] = 1;
                as[2] = eta;                 as[3] = lambda;

                if (i > 1)
                {
                    int s1[2] = { i - 1, 0 };
                    int s2[2] = { 0, 0 };
                    MatrixCopySub(s1, s2, 2, i - 1, row, row, L, 2, i - 1, tmp, false);
                    MatrixMultiply(2, 2, as, 2, i - 1, tmp, as_tmp, 1.0);
                    int s10[2] = { 0, 0 };
                    int s20[2] = { i - 1, 0 };
                    MatrixCopySub(s10, s20, 2, i - 1, 2, i - 1, as_tmp, row, row, L, false);
                }

                L[i * row + i - 1] = lambda;

                // i 和 i-1列调换
                for (r = i + 1; r < row; r++)
                {
                    lambda = L[r * row + i];
                    L[r * row + i] = L[r * row + i - 1];
                    L[r * row + i - 1] = lambda;
                }

                for (r = 0; r < row; r++)
                {
                    lambda = iZt[r * row + i];
                    iZt[r * row + i] = iZt[r * row + i - 1];
                    iZt[r * row + i - 1] = lambda;
                }

                il = i;
                sw = 1;
            }
        }
    }

    double ZT[MAXOBSLIM * MAXOBSLIM];
    MatrixTranspose1(row, row, iZt, ZT);
    MatrixInv2(row, row, ZT);
    for (i = 0; i < row; i++)
        for (j = 0; j < row; j++)
        {
            Z[row * i + j] = RoundNum(ZT[row * i + j]);
        }

    MatrixMultiply_BTPB(row, row, Z, Qahat, false, Qzhat);          // Qzhat=(~Z)*Qahat*Z;
    MatrixMultiplyEx("TN", row, 1, row, Z, ahat, zhat, 1.0, 0.0);   // zhat = ZT*ahat;

    return true;
}


// ahat is a column vector with the dimension of "nfixed"
// ahat，整数高斯变化后的模糊度浮点解
// acond，模糊度浮点解的序贯条件估值
// zcond，对序贯条件估值邻近取整（四舍五入）
// step，调整步长
bool ssearch(const double ahat[], const double L[], const double D[], int nfixed, int* ncands, double afixed[], double sqnorm[], double* conDist, double conZcond[], int* gpNum)
{
    if (nfixed <= 0 || *ncands <= 0)return false;

    //initializing the variables for searching
    double Chi2 = 1.0e+18, minSqnorm = 1.0e+18; // edit by Lying
    double dist[MAXOBSLIM] = { 0.0 }, acond[MAXOBSLIM] = { 0.0 }, zcond[MAXOBSLIM] = { 0.0 }, step[MAXOBSLIM] = { 0.0 }, S[MAXOBSLIM * MAXOBSLIM] = { 0.0 };
    int imax = *ncands, row = nfixed, k = row, count = 0;
    bool endsearch = false;

    acond[row - 1] = ahat[row - 1];
    zcond[row - 1] = RoundNum(acond[row - 1]);
    double left = acond[row - 1] - zcond[row - 1];
    step[row - 1] = SGN(left);
    if (step[row - 1] == 0) step[row - 1] = 1;

    if (conDist)Chi2 = *conDist;

    if (conZcond) // 外部提供搜索起始点
    {
        // 生成conZcond对应的S、acond、step、dist
        // double conZconds[10] = { 1,0,0,1,3,1,3,0,0,-2 };
        left = acond[row - 1] - conZcond[row - 1];
        step[row - 1] = SGN(left);
        if (step[row - 1] == 0) step[row - 1] = 1;

        for (k = row - 1; k > 0; k--) {
            dist[k - 1] = dist[k] + left * left / D[k];

            for (int j = 0; j < k; j++)  S[(k - 1) * row + j] = S[k * row + j] + (conZcond[k] - acond[k]) * L[k * row + j];
            acond[k - 1] = ahat[k - 1] + S[(k - 1) * row + k - 1];

            left = acond[k - 1] - conZcond[k - 1];
            step[k - 1] = SGN(left);
            if (step[row - 1] == 0) step[row - 1] = 1;
        }
        memcpy(zcond, conZcond, nfixed * sizeof(double));
        left = zcond[0] - acond[0];
        k = 1;
    }
    if (gpNum)*gpNum = 0;

    while (!endsearch)
    {
        double newdist = dist[k - 1] + left * left / D[k - 1];
        if (gpNum)*gpNum = *gpNum + 1;

        if (newdist < Chi2)
        {
            if (k != 1)
            {
                k = k - 1;
                dist[k - 1] = newdist;
                for (int j = 0; j < k; j++)  S[(k - 1) * row + j] = S[k * row + j] + (zcond[k] - acond[k]) * L[k * row + j];
                acond[k - 1] = ahat[k - 1] + S[(k - 1) * row + k - 1];
                zcond[k - 1] = RoundNum(acond[k - 1]);

                // added by FengZZ
                // 由于精度有限,acond后续的小数部分可能被省去,导致acond == zcond
                // 由此引起left = acond.x[k-1]-zcond.x[k-1] == 0
                // 导致newdist<Chi2, 进入死循环
                if (acond[k - 1] == zcond[k - 1]) acond[k - 1] += 1e-8;

                left = acond[k - 1] - zcond[k - 1];
                step[k - 1] = SGN(left);
                if (step[row - 1] == 0) step[row - 1] = 1;
            }
            else
            {
                //printf("%3d,%3d,%lf\n", nfixed, *ncands, Chi2);
                if (count < *ncands - 1)
                {
                    count = count + 1;
                    for (int j = 0; j < row; j++) afixed[j * *ncands + count - 1] = zcond[j];
                    sqnorm[count - 1] = newdist;
                    if (*ncands > 2 && newdist < minSqnorm) { // edit by Lying
                        minSqnorm = newdist;
                        Chi2 = (sqrt(minSqnorm) + 13.8155); // r=0.01,c=-2*lnr
                        Chi2 = Chi2 * Chi2;
                    }
                }
                else
                {
                    for (int j = 0; j < row; j++) afixed[j * *ncands + imax - 1] = zcond[j];
                    sqnorm[imax - 1] = newdist;
                    Chi2 = sqnorm[0]; imax = 1;
                    for (int j = 0; j < *ncands; j++)
                    {
                        if (sqnorm[j] > Chi2)
                        {
                            Chi2 = sqnorm[j];
                            imax = j + 1;
                        }
                    }
                }

                zcond[0] = zcond[0] + step[0];
                left = acond[0] - zcond[0];
                step[0] = -step[0] - SGN(step[0]);
            }
        }
        else
        {
            if (k == row)
                endsearch = true;
            else
            {
                k = k + 1;
                zcond[k - 1] = zcond[k - 1] + step[k - 1];
                left = acond[k - 1] - zcond[k - 1];
                step[k - 1] = -step[k - 1] - SGN(step[k - 1]);
            }
        }
    }

    if (count == *ncands - 1)count = count + 1;
    sort_rows(sqnorm, afixed, nfixed, count, *ncands);
    for (int i = 0; i < row; i++)
    {
        for (int j = 0; j < count; j++)
        {
            afixed[i * count + j] = RoundNum(afixed[i * count + j]);
        }
    }
    *ncands = count;

    return true;
}


static double ratioinv(double Pf_FIX, double PfILS, int n)
{
    int kPf = (int)(floor(Pf_FIX * 1000 + 0.5));
    const float* table;

    int row = 0;
    int col = 0;

    if (n < 1)
    {
        table = NULL;
        return 0.0;
    }

    if (kPf == 1)
    {
        row = sizeof(ls_table1) / sizeof(ls_table1[0]);
        col = sizeof(ls_table1[0]) / sizeof(float);
        if (n > col - 1) n = col - 1;
        table = ls_table1[0];
    }
    else if (kPf == 10)
    {
        row = sizeof(ls_table10) / sizeof(ls_table10[0]);
        col = sizeof(ls_table10[0]) / sizeof(float);
        if (n > col - 1) n = col - 1;
        table = ls_table10[0];
    }
    else
    {
        table = NULL;
        return 0.0;
    }

    double mu = 0.0;

    if (PfILS <= table[0 * col + 0])
    {
        mu = table[0 * col + n];
    }
    if (PfILS >= table[(row - 1)*col + 0])
    {
        mu = table[(row - 1)*col + n];
    }
    else
    {
        for (int i = 0; i < row; i++)
        {
            if (table[i*col + 0] == PfILS)
            {
                mu = table[i*col + n];
                break;
            }
            if (table[i*col + 0] < PfILS && PfILS < table[(i + 1)*col + 0])
            {
                double x[2] = { 0.0 };
                double y[2] = { 0.0 };
                x[0] = table[i*col + 0];
                x[1] = table[(i + 1)*col + 0];
                y[0] = table[i*col + n];
                y[1] = table[(i + 1)*col + n];

                mu = (y[1] - y[0]) / (x[1] - x[0])*(PfILS - x[0]) + y[0]; // 线性内插

                break;
            }
        }
    }

    if (mu <= 0.0) mu = 1e-10;

    table = NULL;
    return mu;
}


// D = Mat(row,1);
double SR_Bootstrap(const double D[], int nfixed)
{
    double Ps = 1.0;

    for (int i = 0; i < nfixed; i++)
    {
        Ps *= (2.0 * (normcdf(0.5 / sqrt(D[i]))) - 1.0);
    }

    return Ps;
}


double SR_Rounding(double flo, double sigma)
{
    double Ps = 0;
    double tPs = 0;

    double frac = fabs(flo - RoundNum(flo));
    sigma = sqrt(2.0)*sigma;
    double val1 = 0;
    double val2 = 0;
    int i = 1;

    while (1)
    {
        val1 = (i - frac);
        val2 = (i + frac);
        Ps += (erfc(val1 / sigma) - erfc(val2 / sigma));
        if (fabs(Ps - tPs) < 10E-6)break;
        tPs = Ps;
        i++;
    }
    Ps = 1 - Ps;
    return Ps;
}


double ComputeADOP(const double D[], int nfixed)
{
    double d = 1.0;
    for (int i = 0; i < nfixed; i++) d *= D[i];
    double ADOP = pow(sqrt(d), (1.0 / nfixed));
    return ADOP;
}



double SR_ADOP(const double D[], int nfixed)
{
    double ADOP = ComputeADOP(D, nfixed);
    double Ps = pow((2 * normcdf(0.5 / ADOP) - 1), nfixed);
    return Ps;
}


// Constructor function for CILSEstimator
void InitCILSEstimator(CILSEstimator* pStruct)
{
    if (!pStruct)return;

    pStruct->m_FTThresBound[0] = 1.5;
    pStruct->m_FTThresBound[1] = 5.0;
    pStruct->m_ARThres = 2.5;
    pStruct->m_ADOPThres = 0.1;
    pStruct->m_SRBSThres = 0.995;
    pStruct->m_nfixed = 0;
    pStruct->m_ncands = NCANDS;
    pStruct->m_FFRT = 0;
}


bool InitLambda(CILSEstimator* pStruct, int n)
{
    if (!pStruct)return false;

    pStruct->m_nfixed = n;
    //pStruct->m_ncands = NCANDS;

    if (pStruct->m_method == 6)      { pStruct->m_ncands = 2; pStruct->m_P0 = 0.001; pStruct->m_FFRT = 1; }
    else if (pStruct->m_method == 9) { pStruct->m_ncands = NCANDS; }
    else
    {
        pStruct->m_mu = 1;
        return false;
    }

    //FreeLambda();
    //pStruct->m_Float.mat(n, 1);
    //pStruct->m_QFloat.mat(n, n);
    //pStruct->m_sqnorm.mat(1, pStruct->m_ncands);
    //pStruct->m_afixed.mat(n, pStruct->m_ncands);
    //pStruct->m_L.mat(n, n);
    //pStruct->m_D.mat(n, 1);
    //pStruct->m_zhat.mat(n, 1);
    //pStruct->m_Qzhat.mat(n, n);
    //pStruct->m_Z.mat(n, n);
    //pStruct->m_iZt.mat(n, n);
    //pStruct->m_incr.mat(n, 1);
    //pStruct->m_zfixed.mat(n, pStruct->m_ncands);
    
    // 是否要将所有数组置为0？后续需验证
    SetValsD(pStruct->m_Float, 0, n);
    SetValsD(pStruct->m_QFloat, 0, n * n);
    SetValsD(pStruct->m_sqnorm, 0, pStruct->m_ncands);
    SetValsD(pStruct->m_afixed, 0, n);
    SetValsD(pStruct->m_L, 0, n * n);
    SetValsD(pStruct->m_D, 0, n);
    SetValsD(pStruct->m_zhat, 0, n);
    SetValsD(pStruct->m_Qzhat, 0, n * n);
    SetValsD(pStruct->m_Z, 0, n * n);
    SetValsD(pStruct->m_iZt, 0, n * n);
    SetValsD(pStruct->m_incr, 0, n);
    SetValsD(pStruct->m_zfixed, 0, n * pStruct->m_ncands);

    pStruct->m_ARRatio = 0.0;
    pStruct->m_ADOP = 0.0;
    pStruct->m_SR_ADOP = 0.0;
    pStruct->m_SR_Bootstrap = 0.0;
    pStruct->m_ADOPFull = 0.0;
    pStruct->m_SR_ADOPFull = 0.0;
    pStruct->m_SR_BootstrapFull = 0.0;

    return true;
}


bool LAMBDA(CILSEstimator* pStruct, bool bCons)
{
    if (!pStruct)return false;

    int n = pStruct->m_nfixed;

    if (CheckInput(pStruct) == false) return false;

    // Remove integer numbers from float solution,
    for (int i = 0; i < n; i++)
    {
        pStruct->m_incr[i] = (int)(pStruct->m_Float[i]);
    }

    MatrixSubtraction2(pStruct->m_nfixed, 1, false, pStruct->m_incr, pStruct->m_Float, 1.0, 1.0); // pStruct->m_Float = pStruct->m_Float - pStruct->m_incr;

    // Compute Z matrix based on the decomposition
    if (decorrel(pStruct->m_QFloat, pStruct->m_Float, pStruct->m_Qzhat, pStruct->m_Z, pStruct->m_L, pStruct->m_D, pStruct->m_zhat, pStruct->m_iZt, n) == false) return false;

    for (int i = 0; i < pStruct->m_nfixed; i++) pStruct->m_Float[i] += pStruct->m_incr[i]; // edit by Lying

    // 部分模糊度固定在内部确定
    if (pStruct->m_method != 5)
    {
        pStruct->m_ADOP = ComputeADOP(pStruct->m_D, n);
        pStruct->m_SR_ADOP = SR_ADOP(pStruct->m_D, n);
        pStruct->m_SR_Bootstrap = SR_Bootstrap(pStruct->m_D, n);
    }
    else
    {
        pStruct->m_ADOPFull = ComputeADOP(pStruct->m_D, n);
        pStruct->m_SR_ADOPFull = SR_ADOP(pStruct->m_D, n);
        pStruct->m_SR_BootstrapFull = SR_Bootstrap(pStruct->m_D, n);
    }

    if (pStruct->m_method == 6)
    {
        pStruct->m_Ps = pStruct->m_SR_Bootstrap;

        if (pStruct->m_SRBSThres > 0 && pStruct->m_Ps < pStruct->m_SRBSThres) return false;
        if (pStruct->m_ADOPThres > 0 && pStruct->m_ADOP > pStruct->m_ADOPThres) return false;

        ssearch(pStruct->m_zhat, pStruct->m_L, pStruct->m_D, n, &pStruct->m_ncands, pStruct->m_zfixed, pStruct->m_sqnorm, NULL, NULL, NULL);
        
        if (pStruct->m_FFRT)
        {
            if (1 - pStruct->m_Ps > pStruct->m_P0) pStruct->m_mu = ratioinv(pStruct->m_P0, 1 - pStruct->m_Ps, n);
            else pStruct->m_mu = 1;
        }

        if (pStruct->m_FTThresBound[0] < 1.0)    pStruct->m_FTThresBound[0] = 1.0;
        if (pStruct->m_FTThresBound[1] > 100.0)  pStruct->m_FTThresBound[1] = 100.0;

        pStruct->m_FTThres = 1.0 / pStruct->m_mu;
        if (pStruct->m_FTThres < pStruct->m_FTThresBound[0]) pStruct->m_FTThres = pStruct->m_FTThresBound[0]; // 下限还是不设比较好
        if (pStruct->m_FTThres > pStruct->m_FTThresBound[1]) pStruct->m_FTThres = pStruct->m_FTThresBound[1];

        if (pStruct->m_sqnorm[1] / pStruct->m_sqnorm[0] < pStruct->m_FTThres)
        {
            double aFixed[MAXOBSLIM] = { 0.0 };
            for (int i = 0; i < pStruct->m_nfixed; i++) aFixed[i] = pStruct->m_zfixed[i * pStruct->m_ncands];
            MatrixMultiply(pStruct->m_nfixed, pStruct->m_nfixed, pStruct->m_iZt, pStruct->m_nfixed, 1, aFixed, pStruct->m_afixed, 1.0);
            for (int i = 0; i < pStruct->m_nfixed; i++) pStruct->m_afixed[i] += pStruct->m_incr[i];

            //pStruct->m_nfixed = 0;
            //pStruct->m_ncands = 1;
            return false;
        }
        else
        {
            double aFixed[MAXOBSLIM] = { 0.0 };
            for (int i = 0; i < pStruct->m_nfixed; i++) aFixed[i] = pStruct->m_zfixed[i * pStruct->m_ncands];
            MatrixMultiply(pStruct->m_nfixed, pStruct->m_nfixed, pStruct->m_iZt, pStruct->m_nfixed, 1, aFixed, pStruct->m_afixed, 1.0);
            for (int i = 0; i < pStruct->m_nfixed; i++) pStruct->m_afixed[i] += pStruct->m_incr[i];

            pStruct->m_ARRatio = pStruct->m_sqnorm[0] > 0 ? (pStruct->m_sqnorm[1] / pStruct->m_sqnorm[0]) : 0.0;
            if (pStruct->m_ARRatio > 999.9) pStruct->m_ARRatio = 999.9;

            return true;
        }
    }
    else if (pStruct->m_method == 9)  // BIE
    {
        if (bCons) // 注意此处必须先计算ILS估计器，否则zCons会约束错误
            ssearch(pStruct->m_zhat, pStruct->m_L, pStruct->m_D, n, &pStruct->m_ncands, pStruct->m_zfixed, pStruct->m_sqnorm, NULL, pStruct->m_BIEOptZFixed, NULL);
        else 
            ssearch(pStruct->m_zhat, pStruct->m_L, pStruct->m_D, n, &pStruct->m_ncands, pStruct->m_zfixed, pStruct->m_sqnorm, NULL, NULL, NULL);

        int BIEncands = 0;
        double PDF_sum = 0.0, PDF_cands[NCANDS] = { 0.0 }, P_cands[NCANDS] = { 0.0 }, a = 3;

        // number of candidates and weight determination
        if (pStruct->m_BIEWeightMethod == 0) // iFlex
        {
            double c = pStruct->m_sqnorm[0] + 9.21; // r=0.01,c=-2*lnr
            for (int i = 0; i < pStruct->m_ncands; i++)
            {
                if (pStruct->m_sqnorm[i] >= c)break;
                PDF_cands[i] = exp(-0.5 * pStruct->m_sqnorm[i]);
                PDF_sum += PDF_cands[i];
                BIEncands++;
            }
            if (PDF_sum == 0)return false;
            for (int i = 0; i < BIEncands; i++)
            {
                P_cands[i] = PDF_cands[i] / PDF_sum;
            }
        }
        else if (pStruct->m_BIEWeightMethod == 1) // OIA
        {
            if (0) // 旧做法：搜索500个候选解，再确定BIE候选解数量
            {
                double c = sqrt(pStruct->m_sqnorm[0]) + 13.8155; // r=0.01,c=-2*lnr
                c = c * c;
                for (int i = 0; i < pStruct->m_ncands; i++)
                {
                    if (pStruct->m_sqnorm[i] >= c)break;
                    PDF_cands[i] = exp(-sqrt(pStruct->m_sqnorm[i]) / a);
                    PDF_sum += PDF_cands[i];
                    BIEncands++;
                }
                if (PDF_sum == 0)return false;
                for (int i = 0; i < BIEncands; i++)
                {
                    P_cands[i] = PDF_cands[i] / PDF_sum;
                }
            }
            else // 新做法：搜索过程中确定BIE候选解数量
            {
                for (int i = 0; i < pStruct->m_ncands; i++)
                {
                    PDF_cands[i] = exp(-sqrt(pStruct->m_sqnorm[i]) / a);
                    PDF_sum += PDF_cands[i];
                }
                if (PDF_sum == 0.0)return false;
                for (int i = 0; i < pStruct->m_ncands; i++)
                {
                    P_cands[i] = PDF_cands[i] / PDF_sum;
                }
                BIEncands = pStruct->m_ncands;
            }
        }

        // weighted fusion among candidates
        double aBIE[MAXOBSLIM] = { 0.0 };
        for (int i = 0; i < BIEncands; i++)for (int j = 0; j < n; j++) aBIE[j] += pStruct->m_zfixed[j * pStruct->m_ncands + i] * P_cands[i];
        MatrixMultiply(pStruct->m_nfixed, pStruct->m_nfixed, pStruct->m_iZt, pStruct->m_nfixed, 1, aBIE, pStruct->m_afixed, 1.0);
        for (int i = 0; i < pStruct->m_nfixed; i++) pStruct->m_afixed[i] += pStruct->m_incr[i];

        return true;
    }

    return false;
}
